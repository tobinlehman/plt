var faSliders;!function(b){faSliders={init:function(){b(".fa-area-code-label").click(function(){b(this).next(".fa-area-desc").toggle()});var a,c,d=this,e=b(".widgets-chooser"),f=e.find(".widgets-chooser-sidebars"),g=b("div.widgets-sortables"),h=!("undefined"==typeof isRtl||!isRtl);b("#widgets-right .sidebar-name").click(function(){var a=b(this),c=a.closest(".widgets-holder-wrap");c.hasClass("closed")?(c.removeClass("closed"),a.parent().sortable("refresh")):c.addClass("closed")}),b("#widgets-left .sidebar-name").click(function(){b(this).closest(".widgets-holder-wrap").toggleClass("closed")}),b(document.body).bind("click.widgets-toggle",function(a){var c,d,e,f,g,i=b(a.target),j={"z-index":100};i.parents(".widget-top").length&&!i.parents("#available-widgets").length?(c=i.closest("div.widget"),d=c.children(".widget-inside"),e=parseInt(c.find("input.widget-width").val(),10),f=c.parent().width(),d.is(":hidden")?(e>250&&e+30>f&&c.closest("div.widgets-sortables").length&&(g=c.closest("div.widget-liquid-right").length?h?"margin-right":"margin-left":h?"margin-left":"margin-right",j[g]=f-(e+30)+"px",c.css(j)),d.slideDown("fast")):d.slideUp("fast",function(){c.attr("style","")}),a.preventDefault()):i.hasClass("widget-control-save")?(faSliders.save(i.closest("div.widget"),0,1,0),a.preventDefault()):i.hasClass("widget-control-remove")?(faSliders.save(i.closest("div.widget"),1,1,0),a.preventDefault()):i.hasClass("widget-control-close")&&(faSliders.close(i.closest("div.widget")),a.preventDefault())}),g.children(".widget").each(function(){var a=b(this);faSliders.appendTitle(this),a.find("p.widget-error").length&&a.find("a.widget-action").trigger("click")}),b("#widget-list").children(".widget").draggable({connectToSortable:"div.widgets-sortables",handle:"> .widget-top > .widget-title",distance:2,helper:"clone",zIndex:100,containment:"document",start:function(a,e){var f=b(this).find(".widgets-chooser");e.helper.find("div.widget-description").hide(),c=this.id,f.length&&(b("#wpbody-content").append(f.hide()),e.helper.find(".widgets-chooser").remove(),d.clearWidgetSelection())},stop:function(){a&&b(a).hide(),a=""}}),g.sortable({placeholder:"widget-placeholder",items:"> .widget",handle:"> .widget-top > .widget-title",cursor:"move",distance:2,containment:"document",start:function(a,c){var d,e=b(this),f=e.parent(),g=c.item.children(".widget-inside");"block"===g.css("display")&&(g.hide(),b(this).sortable("refreshPositions")),f.hasClass("closed")||(d=c.item.hasClass("ui-draggable")?e.height():1+e.height(),e.css("min-height",d+"px"))},stop:function(d,e){var f,g,h,i,j,k,l=e.item,m=c;return m||(m=b(e.item).attr("id")),l.hasClass("deleting")?(faSliders.save(l,1,0,1),void l.remove()):(f=l.find("input.add_new").val(),g=l.find("input.multi_number").val(),l.attr("style","").removeClass("ui-draggable"),c="",f&&("multi"===f?(l.html(l.html().replace(/<[^<>]+>/g,function(a){return a.replace(/__i__|%i%/g,g)})),l.attr("id",m.replace("__i__",g)),g++,b("div#"+m).find("input.multi_number").val(g)):"single"===f&&(l.attr("id","new-"+m),a="div#"+m),faSliders.save(l,0,0,1),l.find("input.add_new").val(""),b(document).trigger("widget-added",[l])),h=l.parent(),h.parent().hasClass("closed")&&(h.parent().removeClass("closed"),i=h.children(".widget"),i.length>1&&(j=i.get(0),k=l.get(0),j.id&&k.id&&j.id!==k.id&&b(j).before(l))),void(f?l.find("a.widget-action").trigger("click"):faSliders.saveOrder(h.attr("id"))))},activate:function(){b(this).parent().addClass("widget-hover")},deactivate:function(){b(this).css("min-height","").parent().removeClass("widget-hover")},receive:function(a,c){var d=b(c.sender);return this.id.indexOf("orphaned_widgets")>-1?void d.sortable("cancel"):void 0}}).sortable("option","connectWith","div.widgets-sortables"),b("#available-widgets").droppable({tolerance:"pointer",accept:function(a){return"widget-list"!==b(a).parent().attr("id")},drop:function(a,c){c.draggable.addClass("deleting"),b("#removing-widget").hide().children("span").html("")},over:function(a,c){c.draggable.addClass("deleting"),b("div.widget-placeholder").hide(),c.draggable.hasClass("ui-sortable-helper")&&b("#removing-widget").show().children("span").html(c.draggable.find("div.widget-title").children("h4").html())},out:function(a,c){c.draggable.removeClass("deleting"),b("div.widget-placeholder").show(),b("#removing-widget").hide().children("span").html("")}}),b("#widgets-right .widgets-holder-wrap").each(function(a,c){var d=b(c),e=d.find(".sidebar-name h3").text(),g=d.find(".widgets-sortables").attr("id"),h=b('<li tabindex="0">').text(b.trim(e));0===a&&h.addClass("widgets-chooser-selected"),f.append(h),h.data("sidebarId",g)}),e.on("click.widgets-chooser",function(a){var c=b(a.target);c.hasClass("button-primary")?(d.addWidget(e),d.closeChooser()):c.hasClass("button-secondary")&&d.closeChooser()}).on("keyup.widgets-chooser",function(a){a.which===b.ui.keyCode.ENTER?b(a.target).hasClass("button-secondary")?d.closeChooser():(d.addWidget(e),d.closeChooser()):a.which===b.ui.keyCode.ESCAPE&&d.closeChooser()})},saveOrder:function(a){var c={action:fa_dynamic_areas.assign_action,areas:[]};c[fa_dynamic_areas.assign_nonce.name]=fa_dynamic_areas.assign_nonce.nonce,a&&b("#"+a).find(".spinner:first").css("display","inline-block"),b("div.widgets-sortables").each(function(){b(this).sortable&&(c["areas["+b(this).attr("id")+"]"]=b(this).sortable("toArray").join(","))}),b.post(ajaxurl,c,function(){b(".spinner").hide()})},save:function(c,d,e,f){var g=c.closest("div.widgets-sortables").attr("id");data="",c=b(c),b(".spinner",c).show(),a={action:"save-widget",savewidgets:b("#_wpnonce_widgets").val(),sidebar:g},d&&(a.delete_widget=1),data+="&"+b.param(a),b.post(ajaxurl,data,function(a){var g;d?(b("input.widget_number",c).val()||(g=b("input.widget-id",c).val(),b("#available-widgets").find("input.widget-id").each(function(){b(this).val()===g&&b(this).closest("div.widget").show()})),e?(f=0,c.slideUp("fast",function(){b(this).remove(),faSliders.saveOrder()})):c.remove()):(b(".spinner").hide(),a&&a.length>2&&(b("div.widget-content",c).html(a),faSliders.appendTitle(c),b(document).trigger("widget-updated",[c]))),f&&faSliders.saveOrder()})},appendTitle:function(a){var c=b('input[id*="-title"]',a).val()||"";c&&(c=": "+c.replace(/<[^<>]+>/g,"").replace(/</g,"&lt;").replace(/>/g,"&gt;")),b(a).children(".widget-top").children(".widget-title").children().children(".in-widget-title").html(c)},close:function(a){a.children(".widget-inside").slideUp("fast",function(){a.attr("style","")})},addWidget:function(a){var c,d,e,f,g,h,i,j=a.find(".widgets-chooser-selected").data("sidebarId"),k=b("#"+j);c=b("#available-widgets").find(".widget-in-question").clone(),d=c.attr("id"),e=c.find("input.add_new").val(),f=c.find("input.multi_number").val(),c.find(".widgets-chooser").remove(),"multi"===e?(c.html(c.html().replace(/<[^<>]+>/g,function(a){return a.replace(/__i__|%i%/g,f)})),c.attr("id",d.replace("__i__",f)),f++,b("#"+d).find("input.multi_number").val(f)):"single"===e&&(c.attr("id","new-"+d),b("#"+d).hide()),k.closest(".widgets-holder-wrap").removeClass("closed"),k.append(c),k.sortable("refresh"),faSliders.save(c,0,0,1),c.find("input.add_new").val(""),b(document).trigger("widget-added",[c]),g=b(window).scrollTop(),h=g+b(window).height(),i=k.offset(),i.bottom=i.top+k.outerHeight(),(g>i.bottom||h<i.top)&&b("html, body").animate({scrollTop:i.top-130},200),window.setTimeout(function(){c.find(".widget-title").trigger("click")},250)},closeChooser:function(){var a=this;b(".widgets-chooser").slideUp(200,function(){b("#wpbody-content").append(this),a.clearWidgetSelection()})},clearWidgetSelection:function(){b("#widgets-left").removeClass("chooser"),b(".widget-in-question").removeClass("widget-in-question")}},b(document).ready(function(){faSliders.init(),b(".fa-area-action.action-delete").click(function(a){confirm(fa_dynamic_areas.messages.delete_confirm)||a.preventDefault()})})}(jQuery);